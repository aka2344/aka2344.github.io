<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>공학연구인턴십_ShelterFinder-1</title>
    <meta name="description" content="나의 코딩 이야기" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://localhost:4000//studyproj" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Finding The Way Developer" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="공학연구인턴십_ShelterFinder-1" />
    <meta property="og:description" content="나의 코딩 이야기" />
    <meta property="og:url" content="http://localhost:4000//studyproj" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="공학연구인턴십_ShelterFinder-1" />
    <meta name="twitter:description" content="나의 코딩 이야기" />
    <meta name="twitter:url" content="http://localhost:4000//studyproj" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Finding The Way Developer",
    "name": "공학연구인턴십_ShelterFinder-1",
    "url": "http://localhost:4000//studyproj",
    "image": "/assets/images/cover1.jpg",
    "description": "나의 코딩 이야기"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Finding The Way Developer" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-fables " role="presentation"><a href="/tag/projects">Projects</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/algorithm">Algorithm</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/etc">ETC</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-windows">

        <header class="post-header">
            <h2 class="post-title">공학연구인턴십_ShelterFinder-1</h2>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/aka2344'>Donghoon Kang</a>
                
            
            <time class="post-date" datetime="2020-06-08">08 Jun 2020</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/projects'>Projects</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <h4 id="서론">서론</h4>

<p>작년 12월 말~올해 2월 초(19.12~20.02) 까지 학교에서 개설된 실습인 공학연구 인턴십에 참여하게 되었다. 학과의 각 연구실별로 학생들이 방학동안 연구 주제를 가지고 연구를 진행하는 프로그램으로, 나의 경우 공간데이터베이스 연구실에서 이 프로그램을 두 달간 진행하였다.</p>

<p>공간데이터연구실에서 진행중인 연구 중 공간에 대한 지형, 위치, 높이 등과 같은 공간정보를 토대로 공간데이터베이스를 활용하여, 해당 공간에 위치한 사람들에게 긴급 상황이 발생하였을 때 가장 빠르게 탈출할 수 있는 대피 경로를 안내해 주는 연구가 있다. 연구는 실내 공간을 대상으로 실내 재실자들에게 화재 발생 시 최적의 대피경로를 제공하는 목적으로 진행중에 있다.</p>

<p>해당 연구를 참고하여, 나는 최근 우리나라에서 발생한 지진 사례들을 보고 사람들이 지진 발생 시 대피소까지 빠르게 대피해야 하는 상황이 발생하였을 때, 현재 위치에서 가장 가까운 대피소까지 대피할 수 있는 가장 빠르고 안전한 대피 경로를 찾아주면 어떨까라는 생각을 해보았다. 이러한 생각이 프로그램 또는 어플리케이션 등으로 구현된다면, 지진이 발생하였을 때 당황하지 않고 신속히 인근 대피소로 빠르게 대피하여 지진 상황을 신속하고 안전하게 대응할 수 있을 것이라고 생각하였고 이에 대한 연구 및 개발을 시작하기로 결정했다.</p>

<h4 id="설계">설계</h4>

<p>먼저 우리나라에 존재하는 지진 대피소에 대한 위치정보가 필요하다. 이를 위해 전국 지진해일 대피소 엑셀파일을 다운받았고, 이를 공간데이터 형태인 shapefile로 변환하였다. 또한, 최단 경로 분석을 위한 노드, 엣지로 구성된 데이터가 필요한데, 이는 OpenStreetMap에서 도로 데이터를 osm 파일 형식으로 추출하여 PostgreSQL의 Postgis를 통한 공간데이터 형태로 구축하였다. 본 연구에서는 범위를 서울시 영역으로 한정하여 진행하였다.</p>

<p>최단 경로 분석을 위해 다양한 지도 관련 기능을 제공하는 Mapbox gl js를 통해 기본적인 지도 기능을 구현하고,  html에서 자바스크립트를 통해 실행되도록 설계하였다. 대피소를 포함한 추가적인 공간데이터는 Geoserver를 통해 개발자의 로컬 서버에서 공간데이터를 업로드하여 Mapbox상에서 이를 불러와 사용할 수 있도록 설계하였다.</p>

<p>또한, 최단경로 분석은 PostgreSQL의 PostGIS가 제공하는 기능들을 통해 사용자의 현재 위치에서 거리상으로 가장 가까운 대피소 찾기와 해당 대피소까지 대피하는 최단경로 계산 기능을 수행하도록 설계하였다. 이러한 작업은 PostgreSQL의 데이터베이스상에서 이루어지는데, 앞서 설계한 Mapbox의 지도와의 연계를 위해 자바를 통한 DB연동을 구축하여 Servlet을 통해 서버 연동으로 이를 수행하도록 설계하였다.</p>

<p>종합적으로, 본 연구에 사용한 개발 도구들은 다음과 같다.</p>

<ul>
  <li>Mapbox GL js</li>
  <li>GeoServer</li>
  <li>PostgreSQL(PostGIS)</li>
  <li>Java(sevlet)</li>
</ul>

<h4 id="개발-과정">개발 과정</h4>

<p>앞서 설명하였듯이, 오픈 소스인 OpenStreetMap의 데이터를 이용하여 최단분석에 필요한 노드-링크 형태의 그래프 데이터를 공간데이터베이스 상에 구축하여야 한다. 기본적으로 OpenStreetMap에는 지리상으로 존재하는 도로, 인도 데이터가 포함되어 있으므로 이를 추출하여 활용할 수 있다.</p>

<p>이는 PostgreSQL의 Postgis 기능 중 하나인 osm2pgrouting을 사용하여 osm파일을 경로분석이 가능한 pgrouting의 형태로 데이터베이스에 저장하도록 실행한다. 아래 사진은 osm2pgrouting 기능에 대한 각각의 옵션과 설명이다. osm2pgrouting에 대한 자세한 설명은 <a href="https://github.com/pgRouting/osm2pgrouting/wiki/Documentation-for-osm2pgrouting-v2.2">링크</a> 를 통해 확인할 수 있다.</p>

<p><img src="/assets/OSM2PGROUTING.PNG" alt="OSM2PGROUTING" /></p>

<p>이를 실행하여 osm 데이터를 변환하면, PostgreSQL 데이터베이스에는 도로에 대한 노드, 엣지 데이터가 추출되어 아래와 같이 저장된다.</p>

<p><img src="/assets/ways.PNG" alt="ways" /></p>

<p><img src="/assets/node.PNG" alt="node" /></p>

<p>첫번째 사진은 ways 테이블로 각 도로들에 대한 주소, 좌표, 이름, 노드, 길이,  비용 등이 저장되어 있다. 두번째 사진은 ways_vertices_pgr 테이블로 각각의 노드들에 대한 주소와 좌표가 저장되어 있다.</p>

<p>이렇게 구축된 노드-링크 형태의 데이터를 gis tool(QGIS)를 통해 지도상에 표현하면 다음과 같이 나타난다.</p>

<p><img src="/assets/nodeedge.PNG" alt="노드엣지" /></p>

<p>따라서 이렇게 구축된 데이터를 통해 경로 분석이 가능한데, 특히 ways 테이블에 저장된 비용(cost) 항목을 통해 최단경로를 계산하는 알고리즘을 사용할 수 있다. 이는, 각 도로의 길이에 비례한 항목으로 도로가 길면 높은 비용을, 도로가 짧으면 낮은 비용이 저장되며 이를 통해 그래프 알고리즘에서 최단경로 계산에 사용되는 항목이 된다.</p>

<p>다음으로, 지진 대피소에 대한 데이터를 구축한다.  먼저, 공공데이터 포털에서 전국 지진해일 대피소가 있는 엑셀 파일을 다운받고, 서울시에 대한 대피소만 나누어 저장한다.</p>

<p><img src="/assets/shelter.PNG" alt="shelter" /></p>

<p>대피소 엑셀 파일에는 이름, 주소, 좌표, 수용인원, 관리기관 등에 대한 항목들이 저장되어 있는데, 여기서 좌표에 해당하는 위도와 경도값을 통해 지리상의 공간데이터로 구축이 가능하다. 위 파일을 csv로 변환하고, QGIS에 로드하면 각 대피소들이 좌표에 대응하는 위치에 표시가 되고, 이를 다시 공간데이터 형태인 shp파일로 저장한다. 위의 qgis 화면에 나와있는 shelter 포인트들이 각각의 대피소 데이터이다.</p>

<p>대피소 데이터의 경우, 경로 분석 뿐만 아니라 사용자의 지도상에서도 출력되어 각각의 위치를 확인할 수 있어야 하므로, Mapbox상의 지도에 표현되어야 한다. 앞서 저장한 대피소의 shp파일을 공간적인 json 형태인 geojson 파일로 저장하여 mapbox에 로드하여 정적 파일로서 사용할 수 있으나, 대피소의 경우 새롭게 추가되거나 기존 대피소가 폐쇄되는 경우가 발생할 경우, 이를 반영하여 긴급 상황에서도 활용하는데 한계가 존재하기 때문에, 서버에서 불러오는 형태로 데이터가 저장되어야 한다.</p>

<p>따라서, 이를 위해 별도의 서버를 구축해야 하는데, 이는 GeoServer를 통해 구현이 가능하다.</p>

<p><img src="/assets/geoserver.PNG" alt="geoserver" /></p>

<p>위 화면은 GeoServer의 메인 페이지 화면으로, 설치를 마치고 서버를 시작하면 위와 같은 메인페이지로 접속이 가능하며, 데이터 항목에서 공간데이터를 업로드 할 수 있다. 이렇게 서버에 업로드한 데이터를 WMS(World Map Service)형태로 Export하여 외부에서 사용할 수 있는데, Mapbox에서 이러한 형태로 대피소 데이터를 서버에 업로드하고 이를 불러와서 사용할 수 있다.</p>

<p><img src="/assets/mapbox map.PNG" alt="mapbox map" /></p>

<p>Mapbox API를 이용하여 기본적인 지도와 대피소 데이터를 구축하면 위와 같은 화면으로 표시된다. 이것은 HTML 소스를 통해 구현한 화면으로, 자바스크립트를 통해 mapbox의 지도 기능과 wms 를 통한 외부 데이터(대피소) 출력을 구현하였다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s1">'shelter'</span><span class="p">,{</span>

<span class="s1">'type'</span><span class="p">:</span> <span class="s1">'geojson'</span><span class="p">,</span>

<span class="s1">'data'</span><span class="p">:</span> <span class="s1">'http://localhost:8080/geoserver/test1/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=test1:shel_seoul&amp;maxFeatures=3000&amp;outputFormat=application/json'</span>

<span class="p">})</span>

<span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span>

<span class="p">{</span>

<span class="s1">'id'</span><span class="p">:</span> <span class="s1">'points'</span><span class="p">,</span>

<span class="s1">'type'</span><span class="p">:</span> <span class="s1">'symbol'</span><span class="p">,</span>

<span class="s1">'source'</span><span class="p">:</span> <span class="s1">'shelter'</span><span class="p">,</span>

<span class="s1">'layout'</span><span class="p">:</span> <span class="p">{</span>

<span class="c1">// get the icon name from the source's "icon" property</span>

<span class="c1">// concatenate the name to get an icon from the style's sprite sheet</span>

<span class="c1">// get the title name from the source's "title" property</span>

<span class="s2">"icon-image"</span><span class="p">:</span> <span class="s2">"marker-15"</span><span class="p">,</span>

<span class="s2">"icon-size"</span><span class="p">:</span> <span class="mi">3</span>

<span class="p">}}</span> 

<span class="p">);</span>
</code></pre></div></div>

<p>위 코드는 스크립트 코드 중 대피소 데이터를 지도에 추가하는 부분인데, 코드에서 확인할 수 있듯이 wms 주소를 입력하여 해당 대피소 데이터를 mapbox 상에서의 layer 형태로 추가하는 것을 볼 수 있다. 따라서 추가된 대피소 데이터들은 마커의 형태로 지도 위에 출력된다.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/aka2344" style="background-image: url(/assets/images/casper.png)"><span class="hidden">aka2344's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/aka2344">Donghoon Kang</a></h4>

                        
                            <p> 백엔드 개발자를 꿈꾸는 개발장비니다.</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Seoul, Korea</span>
                            <span class="author-link icon-link"><a href="http://aka2344.github.io/"> aka2344.github.io</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=공학연구인턴십_ShelterFinder-1&amp;url=http://localhost:4000studyproj"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000studyproj"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:4000studyproj"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'aka2344'; // required: replace example with your forum shortname
        var disqus_identifier = '/studyproj';
        var disqus_url = 'http://localhost:4000/studyproj';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story no-cover" href="/studyproj2">
            <section class="post">
                <h2>공학연구인턴십_ShelterFinder-2</h2>
                <p>다음으로, 구축된 지도와 대피소 데이터, 도로 데이터를 기반으로 최단 경로 알고리즘을 구현하여야 한다. 먼저, 사용자의...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev no-cover" href="/picnic">
            <section class="post">
                <h2>[종만북]6.무식하게 풀기-소풍</h2>
                <p>문제 출처 : https://algospot.com/judge/problem/read/PICNIC 안드로메다 유치원 익스프레스반에서는 다음 주에 율동공원으로 소풍을 갑니다. 원석 선생님은 소풍...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Finding The Way Developer</a> &copy; 2021</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-69281367-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
